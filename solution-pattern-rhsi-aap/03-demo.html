<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using Red Hat Service Interconnect to extend the reach of Ansible Automation Platform :: Solution Patterns for Cloud Native Architectures</title>
    <link rel="canonical" href="https://redhat-solution-patterns.github.io/solution-patterns/solution-pattern-rhsi-aap/03-demo.html">
    <link rel="prev" href="02-architecture.html">
    <link rel="next" href="developer-resources.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" style="font-size: 20px; color: white"
        href="https://redhat-solution-patterns.github.io/solution-patterns">
        <img src="../_/img/logo.png" height="35px" alt="Solution Patterns">&nbsp; Solution Patterns for Cloud Native Architectures</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Architectures &amp; Patterns</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.redhat.com/architect/portfolio/" target="_blank">Portfolio Architecture&nbsp; </a>
            <a class="navbar-item" href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html"  target="_blank">Solution Patterns </a>
            <a class="navbar-item" href="https://validatedpatterns.io/" target="_blank">Validated Patterns&nbsp;</a>
            <a class="navbar-item" href="https://catalog.redhat.com/solutions" target="_blank">Ecosystem Solutions&nbsp;</a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com">Red Hat Developers</a>
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com/app-dev-platform">App Dev Platform</a>
            <a class="navbar-item" target="_blank" href="https://www.redhat.com/en/products/application-foundations">Red Hat Application Services</a>
          </div>
        </div>

          <a class="navbar-item" target="_blank" href="https://github.com/redhat-solution-patterns/redhat-solution-patterns.github.io/issues">Feedback</a>
          <a class="navbar-item" target="_blank" href="https://redhat-solution-patterns.github.io/solution-patterns/contributors-guide.html">Contribute</a>

      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="solution-pattern-rhsi-aap" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Service Interconnect and Ansible Automation Platform</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">1. Home page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#use-cases">1.1 Use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_story_behind_this_solution_pattern">1.2 The story behind this solution pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_solution">1.3 The solution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html">2. Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#tech_stack">2.1. Technology stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#in_depth">2.2. An in-depth look at the solution&#8217;s architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#more_tech">2.3. More about the technology stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#walkthrough_overview">2.4. Walkthrough overview</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html">3. See the Solution in Action</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_before_running_the_solution">3.1. Before runing the solution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#_walkthrough">3.2. Walkthrough</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_installing_the_red_hat_service_interconnect_command_line_tool">3.3. Installing the Red Hat Service Interconnect command line tool</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_installing_red_hat_service_interconnect_on_red_hat_openshift">3.4. Installing RHSI on OCP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_connecting_the_third_party_networks">3.5. Connecting Third Party Networks</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_installing_red_hat_ansible_automation_platform">3.6. Installing AAP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_configuring_your_ansible_automation_platform_instance">3.7. Configuring AAP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_validating_the_scenario">3.8. Validating the scenario</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_conclusion">3.9. Conclusion</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="developer-resources.html">4. Developer Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html" target="_blank" rel="noopener">Explore Red Hat Solution Patterns</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Service Interconnect and Ansible Automation Platform</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Service Interconnect and Ansible Automation Platform</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Service Interconnect and Ansible Automation Platform</a></li>
    <li><a href="03-demo.html">3. See the Solution in Action</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/fgiorgetti/solution-pattern-rhsi-aap/edit/main/documentation/modules/ROOT/pages/03-demo.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Using Red Hat Service Interconnect to extend the reach of Ansible Automation Platform</h1>
<h1 id="_see_the_solution_in_action" class="sect0"><a class="anchor" href="#_see_the_solution_in_action"></a><a class="link" href="#_see_the_solution_in_action">See the Solution in Action</a></h1>
<div class="sect1">
<h2 id="_before_running_the_solution"><a class="anchor" href="#_before_running_the_solution"></a><a class="link" href="#_before_running_the_solution">1. Before running the solution</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to reproduce the following solution, you will need the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to a running Red Hat OpenShift cluster with Red Hat Ansible Automation Platform operator available through the Operator Hub</p>
</li>
<li>
<p>A subscription or trial license for Red Hat Ansible Automation Platform (running on Red Hat OpenShift cluster)</p>
</li>
<li>
<p>Red Hat Service Interconnect (version 2.x) RPM to be installed at the Red Hat Enterprise Linux machine (for Third-party Network A)</p>
</li>
<li>
<p>A few virtual machines to be used as third-party servers, with SSH server running</p>
</li>
<li>
<p>A machine or a virtual machine with Red Hat Enterprise Linux to simulate third-party network A, with access to the respective servers</p>
</li>
<li>
<p>A Linux machine or virtual machine with Podman version 4+ to simulate third-party network B, with access to the respective servers (optional)</p>
</li>
<li>
<p>Install the Skupper CLI version 2.x</p>
</li>
<li>
<p>The following commands are expected: <code>kubectl</code>, <code>jq</code>, <code>awk</code>, <code>wget</code> and <code>podman</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_walkthrough"><a class="anchor" href="#_walkthrough"></a><a class="link" href="#_walkthrough">2. Walkthrough</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installing_the_red_hat_service_interconnect_command_line_tool"><a class="anchor" href="#_installing_the_red_hat_service_interconnect_command_line_tool"></a><a class="link" href="#_installing_the_red_hat_service_interconnect_command_line_tool">2.1. Installing the Red Hat Service Interconnect command line tool</a></h3>
<div class="paragraph">
<p>You need to install the Red Hat Service Interconnect command line tool in order to generate AccessTokens to the connect your third-party
network sites with Red Hat Service Interconnect running in the cloud.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">curl https://skupper.io/install.sh | sh -s -- --version 2.0.0-preview-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script installs the command under your home directory. It prompts you to add the command to your path if necessary.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_red_hat_service_interconnect_on_red_hat_openshift"><a class="anchor" href="#_installing_red_hat_service_interconnect_on_red_hat_openshift"></a><a class="link" href="#_installing_red_hat_service_interconnect_on_red_hat_openshift">2.2. Installing Red Hat Service Interconnect on Red Hat OpenShift</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following instructions use the upstream version of Red Hat Service Interconnect (Skupper V2),<br>
as at the time this solution pattern has been written, RHSI Version 2 has not yet been released.<br>
Once RHSI Version 2 is released, this whole section will be updated to use it instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We need to install <strong>Red Hat Service Interconnect</strong> in two separate namespaces.<br>
The reason for this is to ensure that each third-party network is connected to an isolated <em>Virtual Application Network</em> (VAN).</p>
</div>
<div class="paragraph">
<p>Along with that we will also create <em>Network Policies</em> to ensure that each namespace is only accessible by AAP, so that the third-party servers exposed into the Red Hat OpenShift cluster can only be reached internally by AAP.</p>
</div>
<div class="sect3">
<h4 id="_installing_the_red_hat_service_interconnect_controller"><a class="anchor" href="#_installing_the_red_hat_service_interconnect_controller"></a><a class="link" href="#_installing_the_red_hat_service_interconnect_controller">2.2.1. Installing the <strong>Red Hat Service Interconnect</strong> controller</a></h4>
<div class="paragraph">
<p>The RHSI controller is deployed to its own namespace and it has the ability to watch for RHSI resources across all namespaces in the Red Hat OpenShift cluster.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s install the RHSI controller:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open a terminal</p>
</li>
<li>
<p>Set the <strong>KUBECONFIG</strong> environment variable</p>
<div class="ulist">
<ul>
<li>
<p>You must be logged in as a cluster administrator</p>
</li>
</ul>
</div>
</li>
<li>
<p>Create the <code><strong>skupper</strong></code> namespace, using:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">kubectl create namespace skupper</code></pre>
</div>
</div>
</li>
<li>
<p>The RHSI V2 controller can be installed using:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">kubectl -n skupper apply -f https://skupper.io/v2/install.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Now wait for the <strong>skupper-controller</strong> pod to be running on the <strong>skupper</strong> namespace:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">kubectl -n skupper wait --for=condition=Ready pod -l application=skupper-controller</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_create_namespaces_for_each_third_party_network"><a class="anchor" href="#_create_namespaces_for_each_third_party_network"></a><a class="link" href="#_create_namespaces_for_each_third_party_network">2.2.2. Create namespaces for each third-party network</a></h4>
<div class="paragraph">
<p>Once the RHSI controller is running, we need to apply the RHSI Custom Resources (CRs) for the RHSI controller to create the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sites</p>
</li>
<li>
<p>Listeners</p>
</li>
<li>
<p>AccessGrants</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Just as a reminder, this walkthrough will only cover a single namespace on Red Hat OpenShift and a single third-party network. In case you want to add two or more third-party networks, the instructions are basically the same.</p>
</div>
<div class="paragraph">
<p>The first thing we need to do is create the namespace for third-party network A.<br>
The namespace will be named: <code><strong>net-a</strong></code>.</p>
</div>
<div class="paragraph">
<p>This namespace will be used to compose the expected fully qualified hostnames to be used in the AAP inventory, example given: <code><strong>server-a1.net-a</strong></code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the custom resources we need to define this RHSI site.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><strong>Site</strong></code></p>
<div class="ulist">
<ul>
<li>
<p>A Site represents a separate RHSI instance</p>
</li>
<li>
<p>You can only have a single RHSI site per namespace</p>
</li>
<li>
<p>It is the main resource to be created</p>
</li>
</ul>
</div>
</li>
<li>
<p><code><strong>AccessGrant</strong></code></p>
<div class="ulist">
<ul>
<li>
<p>Allows AccessTokens to be redeemed by other sites</p>
</li>
<li>
<p>Can be configured to permit a certain amount of token redemptions</p>
</li>
<li>
<p>Expire after pre-defined amount of time</p>
</li>
<li>
<p>AccessTokens can be generated once the AccessGrant is ready</p>
</li>
</ul>
</div>
</li>
<li>
<p><code><strong>Listener</strong></code></p>
<div class="ulist">
<ul>
<li>
<p>Represents an ingress to target workloads exposed in your Virtual Application Network (VAN)</p>
</li>
<li>
<p>On OpenShift / Kubernetes they are realized as a Service</p>
</li>
<li>
<p>Listeners must have a corresponding Connector available in some other Site linked to the VAN</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The site definiton sets the <strong><em>linkAccess</em></strong> value to <strong><em>default</em></strong>. This will ensure that the default ingress method for the target cluster will be used.<br>
On Red Hat OpenShift clusters, a <strong>Route</strong> should be created, otherwise a <strong>LoadBalancer</strong> service will be created.
This ingress method is used to accept incoming links, coming from other Sites.</p>
</div>
<div class="paragraph">
<p>The <code><strong>AccessGrant</strong></code> allows a single <code><strong>AccessToken</strong></code> to be redeemed and it must be redeemed within 30 minutes from <code><strong>AccessGrant</strong></code> creation, otherwise it won&#8217;t be valid.</p>
</div>
<div class="paragraph">
<p>Each site has a <code><strong>Listener</strong></code> for each target server expected by AAP.<br>
The <code><strong>spec.host</strong></code> field determines the service name that will be created on the respective namespace,
therefore the fully qualified service name will be composed by the <code>spec.host</code> field plus the namespace name, matching the hostnames that will be added to the inventories in AAP.</p>
</div>
<div class="paragraph">
<p>The <code><strong>spec.routingKey</strong></code> is used to determine the matching Connector.
So the RHSI sites created inside the third-party networks, must define the respective <code><strong>spec.routingKey</strong></code>.</p>
</div>
<div class="paragraph">
<p>Along with the RHSI resources, a <em>Network policy</em> will be defined, to add an extra security layer, preventing undesired internal access to your third-party network namespaces.<br>
This <code><strong>NetworkPolicy</strong></code> allows ingress to the <code><strong>skupper-router</strong></code> pod only coming from pods running on the <code><strong>aap</strong></code> or the self namespace <code><strong>net-a</strong></code>.</p>
</div>
<div class="paragraph">
<p>To create the namespace, the RHSI site and the network policy, run the following commands in your terminal that has access to the Red Hat OpenShift cluster. The commands below will first create the resources in a local directory then apply them to the Red Hat OpenShift cluster.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script"># create a directory to hold all resources
mkdir -p cloud/net-a/

# create the resources needed
cat &lt;&lt; EOF &gt; cloud/net-a/00-ns.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: net-a
EOF

cat &lt;&lt; EOF &gt; cloud/net-a/10-site.yaml
apiVersion: skupper.io/v2alpha1
kind: Site
metadata:
  name: net-a
  namespace: net-a
spec:
  linkAccess: default
EOF

cat &lt;&lt; EOF &gt; cloud/net-a/20-accessgrant.yaml
apiVersion: skupper.io/v2alpha1
kind: AccessGrant
metadata:
  name: net-a-grant
  namespace: net-a
spec:
  redemptionsAllowed: 1
  expirationWindow: 30m
EOF

cat &lt;&lt; EOF &gt; cloud/net-a/30-listeners.yaml
---
apiVersion: skupper.io/v2alpha1
kind: Listener
metadata:
  name: server-a1
  namespace: net-a
spec:
  host: server-a1
  port: 22
  routingKey: server-a1
  type: tcp
---
apiVersion: skupper.io/v2alpha1
kind: Listener
metadata:
  name: server-a2
  namespace: net-a
spec:
  host: server-a2
  port: 22
  routingKey: server-a2
  type: tcp
---
apiVersion: skupper.io/v2alpha1
kind: Listener
metadata:
  name: server-a3
  namespace: net-a
spec:
  host: server-a3
  port: 22
  routingKey: server-a3
  type: tcp
EOF

cat &lt;&lt; EOF &gt; cloud/net-a/40-networkpolicy.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: network-policy-aap
  namespace: net-a
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: skupper-router
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: 'kubernetes.io/metadata.name'
          operator: In
          values: ["aap", "net-a"]
  egress:
  - {}
EOF

kubectl apply -f ./cloud/net-a/</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can verify that your site has been created running:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">kubectl -n net-a get pod,site</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you should see an output similar to this one:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre>NAME                                  READY   STATUS    RESTARTS   AGE
pod/skupper-router-78b5b8ddb5-h76sm   2/2     Running   0          53m

NAME                    STATUS   SITES IN NETWORK
site.skupper.io/net-a   OK</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_preparing_site_bundles_for_the_third_party_network"><a class="anchor" href="#_preparing_site_bundles_for_the_third_party_network"></a><a class="link" href="#_preparing_site_bundles_for_the_third_party_network">2.2.3. Preparing site bundles for the third-party network</a></h4>
<div class="paragraph">
<p>A site bundle is a compressed file that contains the whole RHSI site definition to run outside of Kubernetes or OpenShift.<br>
They can be installed to run as a container, using Podman or Docker and also as a regular process on a Red Hat Enterprise Linux server, which will require a local installation of the <code><strong>skupper-router</strong></code> <em>RPM</em> package.</p>
</div>
<div class="paragraph">
<p>The site bundle is an easy approach to install a prepared site definition on a remote location, but you could also create a non-Kubernetes site using the Red Hat Service Interconnect V2 CLI or a bootstrap container.</p>
</div>
<div class="paragraph">
<p>Here are the Custom Resources (CRs) needed to define the site bundles.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><strong>Site</strong></code></p>
</li>
<li>
<p><code><strong>Connectors</strong></code></p>
</li>
<li>
<p><code><strong>AccessToken</strong></code> (will be generated from <code><strong>AccessGrants</strong></code> created earlier)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to prepare a site bundle to be installed at the Third Party Networks, we will create the Custom Resources (CRs) needed along with an <code><strong>AccessTokens</strong></code> that will be extracted from the <code><strong>net-a</strong></code> namespace running on the Red Hat OpenShift cluster.</p>
</div>
<div class="paragraph">
<p>To do it, execute the following commands in a terminal that has access to <code><strong>net-a</strong></code> namespace running on your Red Hat OpenShift cluster:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">mkdir -p internal/net-a

cat &lt;&lt; EOF &gt; internal/net-a/10-site.yaml
apiVersion: skupper.io/v2alpha1
kind: Site
metadata:
  name: net-a
EOF

cat &lt;&lt; EOF &gt; internal/net-a/20-connectors.yaml
---
apiVersion: skupper.io/v2alpha1
kind: Connector
metadata:
  name: server-a1
spec:
  host: 192.168.8.101
  port: 22
  routingKey: server-a1
---
apiVersion: skupper.io/v2alpha1
kind: Connector
metadata:
  name: server-a2
spec:
  host: 192.168.8.102
  port: 22
  routingKey: server-a2
---
apiVersion: skupper.io/v2alpha1
kind: Connector
metadata:
  name: server-a3
spec:
  host: 192.168.8.103
  port: 22
  routingKey: server-a3
EOF

kubectl -n net-a get accessgrant net-a-grant -o template --template '
apiVersion: skupper.io/v2alpha1
kind: AccessToken
metadata:
  name: net-a-token
spec:
  code: "{{ .status.code }}"
  ca: {{ printf "%q" .status.ca }}
  url: "{{ .status.url }}"
' &gt; internal/net-a/30-accesstoken.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that all the CRs are in place, we must generate the site bundle, using:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">curl -s https://raw.githubusercontent.com/skupperproject/skupper/refs/heads/v2/cmd/bootstrap/bootstrap.sh | sh -s -- -p ./internal/net-a -b bundle</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bundle will be generated and its location can be found through a message that says:
"<em>Installation bundle available at</em>". Example given:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre>Installation bundle available at: /home/my-user/.local/share/skupper/bundles/skupper-install-net-a.sh</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_the_third_party_network"><a class="anchor" href="#_connecting_the_third_party_network"></a><a class="link" href="#_connecting_the_third_party_network">2.3. Connecting the Third-party Network</a></h3>
<div class="paragraph">
<p>The last piece to complete the Red Hat Service Interconnect setup is to install the generated site-bundles on the respective server used to reach Third-party Network A (<code><strong>net-a</strong></code>) hosts.</p>
</div>
<div class="paragraph">
<p>To install, you should just send the site bundle file: <code><strong>skupper-install-net-a.sh</strong></code> to the target server where the RHSI site will be installed, then execute it, for example:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">scp skupper-install-net-a.sh my-user@my-server-third-party-net-a:
ssh my-user@my-server-third-party-net-a ./skupper-install-net-a.sh -n net-a</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The commands above have been executed against internal hosts that
represent the servers where the RHSI site bundle will be installed
and these servers can reach the target hosts that will be managed by AAP.<br>
Update the commands to use your own hostnames or IP addresses.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want your <strong>Third Party Network A</strong> site to run using a regular process and not a container, you must first install the <code><strong>skupper-router</strong></code> <em>RPM</em> package and then you should run the bundle installation script as:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">scp skupper-install-net-a.sh my-user@my-server-third-party-net-a:
ssh my-user@my-server-third-party-net-a dnf -y install skupper-router
ssh my-user@my-server-third-party-net-a ./skupper-install-net-a.sh -n net-a -p systemd</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the bundle has been installed, the three servers behind the third party network should be exposed and accessible by AAP inside the Red Hat OpenShift cluster.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s have a quick look at what must be done to install and configure Red Hat Ansible Automation Platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_red_hat_ansible_automation_platform"><a class="anchor" href="#_installing_red_hat_ansible_automation_platform"></a><a class="link" href="#_installing_red_hat_ansible_automation_platform">2.4. Installing Red Hat Ansible Automation Platform</a></h3>
<div class="paragraph">
<p>We will just briefly explain what is expected from your Red Hat Ansible Automation Platform installation on the Red Hat OpenShift cluster.</p>
</div>
<div class="paragraph">
<p>The Red Hat Ansible Automation Platform installation is expected to run in the "<strong>aap</strong>" namespace, using the Red Hat Ansible Automation Platform Operator and an instance of the "Ansible Automation Platform" resource must be created.</p>
</div>
<div class="paragraph">
<p>If you need further information, please refer to the <a href="https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.5/html-single/installing_on_openshift_container_platform/index#proc-install-cli-aap-operatorinstalling-aap-operator-cli">official installation guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_your_ansible_automation_platform_instance"><a class="anchor" href="#_configuring_your_ansible_automation_platform_instance"></a><a class="link" href="#_configuring_your_ansible_automation_platform_instance">2.5. Configuring your Ansible Automation Platform instance</a></h3>
<div class="paragraph">
<p>In order to validate this solution pattern, we will need to configure the Ansible Automation Platform (AAP) instance first.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since the goal is to demonstrate how Red Hat Service Interconnect (RHSI) helps you connect your AAP automation with managed hosts that are not reachable, the AAP configuration used in this solution pattern is minimal.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is what we will configure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A project to run against all hosts</p>
</li>
<li>
<p>An inventory (to represent the Third-party Network A hostnames)</p>
</li>
<li>
<p>Define the credential</p>
</li>
<li>
<p>A job template (for Third-party Network A)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_create_a_project"><a class="anchor" href="#_create_a_project"></a><a class="link" href="#_create_a_project">2.5.1. Create a project</a></h4>
<div class="paragraph">
<p>The Ansible project that will be used in this solution pattern is a simple fork from the ansible-tower-samples repository which includes an extra task that simply creates a directory under <code><strong>/tmp</strong></code> named <code><strong>created-by-aap</strong></code>.<br>
This helps validate that Red Hat Ansible Automation Platform has actually connected and performed this respective task against the target host.</p>
</div>
<div class="paragraph">
<p>In the AAP console, create a project using the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Source control type: <strong>Git</strong></p>
</li>
<li>
<p>Source control URL: <a href="https://github.com/fgiorgetti/ansible-tower-samples.git"><strong>https://github.com/fgiorgetti/ansible-tower-samples.git</strong></a></p>
</li>
<li>
<p>Source control branch/tag/commit: <strong>master</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_inventory"><a class="anchor" href="#_create_the_inventory"></a><a class="link" href="#_create_the_inventory">2.5.2. Create the inventory</a></h4>
<div class="paragraph">
<p>Now that the project has been created, we will create an inventory, to represent the hostnames to be managed inside the Third-party Network A.</p>
</div>
<div class="paragraph">
<p>The inventory must have entries for the following hostnames:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>server-a1.net-a</strong></p>
</li>
<li>
<p><strong>server-a2.net-a</strong></p>
</li>
<li>
<p><strong>server-a3.net-a</strong></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>AAP should be able to resolve these hostnames, as they have been made available as services on the <code><strong>net-a</strong></code> namespace by Red Hat Service Interconnect, based on the <code><strong>Listeners</strong></code> created earlier.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_credential"><a class="anchor" href="#_create_the_credential"></a><a class="link" href="#_create_the_credential">2.5.3. Create the credential</a></h4>
<div class="paragraph">
<p>The inventory has been created but you must also make sure you have defined the appropriate credential on the Red Hat Ansible Automation Platform Console, so that it can connect with those hostnames through SSH.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_job_template"><a class="anchor" href="#_create_the_job_template"></a><a class="link" href="#_create_the_job_template">2.5.4. Create the job template</a></h4>
<div class="paragraph">
<p>We need to create a job template.</p>
</div>
<div class="paragraph">
<p>It will basically tie the Ansible project to be executed with the inventory that defines the target hosts and associate the credential to be used to access the Third-party Network A hosts.</p>
</div>
<div class="paragraph">
<p>Make sure your <code><strong>Job template</strong></code> is configured using the correct <strong>Project</strong>, <strong>Inventory</strong> and <strong>Credential</strong>.</p>
</div>
<div class="paragraph">
<p>At this point, all the AAP configuration needed is done.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_validating_the_scenario"><a class="anchor" href="#_validating_the_scenario"></a><a class="link" href="#_validating_the_scenario">2.6. Validating the scenario</a></h3>
<div class="paragraph">
<p>Now that the whole scenario has been deployed, the <strong><em>Job template</em></strong> that was created on AAP should be able to run and reach all servers.</p>
</div>
<div class="paragraph">
<p>Run your job template and you should be able to see a successful result, as in the illustrative example below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/walkthrough_aap_workflow_success.png" alt="Workflow job template successful">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a><a class="link" href="#_conclusion">3. Conclusion</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat Service Interconnect dramatically expands the reach of your centralized Red Hat Ansible Automation Platform by securely managing previously inaccessible hosts.</p>
</div>
<div class="paragraph">
<p>Its user-friendly and declarative interface makes it easy to extend your automation to a wider range of devices, enabling you to manage hosts across hybrid and multi-cloud environments.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="02-architecture.html" class="query-params-link">2. Architecture</a></span>
  <span class="next"><a href="developer-resources.html" class="query-params-link">4. Developer Resources</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <img
          src="../_/img/app-services-logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns"  href="https://redhat.com" ></a>
</footer><script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
