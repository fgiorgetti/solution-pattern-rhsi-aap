<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using Red Hat Service Interconnect to extend the reach of Ansible Automation Platform :: Solution Patterns for Cloud Native Architectures</title>
    <link rel="canonical" href="https://redhat-solution-patterns.github.io/solution-patterns/solution-pattern-rhsi-aap/03-demo.html">
    <link rel="prev" href="02-architecture.html">
    <link rel="next" href="developer-resources.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" style="font-size: 20px; color: white"
        href="https://redhat-solution-patterns.github.io/solution-patterns">
        <img src="../_/img/logo.png" height="35px" alt="Solution Patterns">&nbsp; Solution Patterns for Cloud Native Architectures</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Architectures &amp; Patterns</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.redhat.com/architect/portfolio/" target="_blank">Portfolio Architecture&nbsp; </a>
            <a class="navbar-item" href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html"  target="_blank">Solution Patterns </a>
            <a class="navbar-item" href="https://validatedpatterns.io/" target="_blank">Validated Patterns&nbsp;</a>
            <a class="navbar-item" href="https://catalog.redhat.com/solutions" target="_blank">Ecosystem Solutions&nbsp;</a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com">Red Hat Developers</a>
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com/app-dev-platform">App Dev Platform</a>
            <a class="navbar-item" target="_blank" href="https://www.redhat.com/en/products/application-foundations">Red Hat Application Services</a>
          </div>
        </div>

          <a class="navbar-item" target="_blank" href="https://github.com/redhat-solution-patterns/redhat-solution-patterns.github.io/issues">Feedback</a>
          <a class="navbar-item" target="_blank" href="https://redhat-solution-patterns.github.io/solution-patterns/contributors-guide.html">Contribute</a>

      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="solution-pattern-rhsi-aap" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Service Interconnect and Ansible Automation Platform</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">1. Home page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#use-cases">1.1 Use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_story_behind_this_solution_pattern">1.2 The story behind this solution pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_solution">1.3 The solution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html">2. Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#tech_stack">2.1. Technology stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#in_depth">2.2. An in-depth look at the solution&#8217;s architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#more_tech">2.3. More about the technology stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html">3. See the Solution in Action</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#_walkthrough">3.1. Walkthrough</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_installing_red_hat_ansible_automation_platform">3.2. Installing AAP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_configuring_your_ansible_automation_platform_instance">3.3. Configuring AAP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_installing_red_hat_service_interconnect_on_red_hat_openshift">3.4. Installing RHSI on OCP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_connecting_the_third_party_networks">3.5. Connecting Third Party Networks</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_validating_the_scenario">3.6. Validating the scenario</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="developer-resources.html">4. Developer Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html" target="_blank" rel="noopener">Explore Red Hat Solution Patterns</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Service Interconnect and Ansible Automation Platform</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Service Interconnect and Ansible Automation Platform</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Service Interconnect and Ansible Automation Platform</a></li>
    <li><a href="03-demo.html">3. See the Solution in Action</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/fgiorgetti/solution-pattern-rhsi-aap/edit/main/documentation/modules/ROOT/pages/03-demo.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Using Red Hat Service Interconnect to extend the reach of Ansible Automation Platform</h1>
<h1 id="_see_the_solution_in_action" class="sect0"><a class="anchor" href="#_see_the_solution_in_action"></a><a class="link" href="#_see_the_solution_in_action">See the Solution in Action</a></h1>
<div class="sect1">
<h2 id="_before_running_the_solution"><a class="anchor" href="#_before_running_the_solution"></a><a class="link" href="#_before_running_the_solution">1. Before running the solution</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to reproduce the following solution, you will need the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to a running Red Hat OpenShift cluster with Red Hat Ansible Automation Platform operator available through the Operator Hub</p>
</li>
<li>
<p>A subscription or trial license for Red Hat Ansible Automation Platform (running on Red Hat OpenShift cluster)</p>
</li>
<li>
<p>Red Hat Service Interconnect (version 2.x) RPM to be installed at the Red Hat Enterprise Linux machine (for Third-party Network A)</p>
</li>
<li>
<p>A few virtual machines to be used as third-party servers, with SSH server running</p>
</li>
<li>
<p>A machine or a virtual machine with Red Hat Enterprise Linux to simulate third-party network A, with access to the respective servers</p>
</li>
<li>
<p>A Linux machine or virtual machine with Podman version 4+ to simulate third-party network B, with access to the respective servers</p>
</li>
<li>
<p>The following commands are expected: <code>kubectl</code>, <code>jq</code>, <code>awk</code>, <code>wget</code> and <code>podman</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_walkthrough"><a class="anchor" href="#_walkthrough"></a><a class="link" href="#_walkthrough">2. Walkthrough</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_downloading_resources_needed"><a class="anchor" href="#_downloading_resources_needed"></a><a class="link" href="#_downloading_resources_needed">2.1. Downloading resources needed</a></h3>
<div class="paragraph">
<p>This walkthrough guide uses some files packaged in a tar ball, which must be downloaded and extracted locally.
To download and extract the files needed, open a terminal and execute the following commands:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">wget https://raw.githubusercontent.com/fgiorgetti/solution-pattern-rhsi-aap/refs/heads/main/documentation/modules/ROOT/assets/resources.tar.gz
tar zxvf resources.tar.gz</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_red_hat_ansible_automation_platform"><a class="anchor" href="#_installing_red_hat_ansible_automation_platform"></a><a class="link" href="#_installing_red_hat_ansible_automation_platform">2.2. Installing Red Hat Ansible Automation Platform</a></h3>
<div class="paragraph">
<p>We will just briefly explain how to install Red Hat Ansible Automation Platform on an Red Hat OpenShift cluster.
If you need further information, please refer to the <a href="https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.5/html-single/installing_on_openshift_container_platform/index#proc-install-cli-aap-operatorinstalling-aap-operator-cli">official installation guide</a>.</p>
</div>
<div class="paragraph">
<p>Before you start, notice that you will need a valid Red Hat Ansible Automation Platform (AAP) subscription to proceed,
otherwise you won&#8217;t be able to complete the AAP installation.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the Red Hat OpenShift console</p>
</li>
<li>
<p>Inside the console, go to: Operators → OperatorHub</p>
</li>
<li>
<p>Search for "Ansible Automation Platform" as shown below:</p>
<div class="imageblock">
<div class="content">
<img src="_images/walkthrough_operator_hub.png" alt="Operator Hub">
</div>
</div>
</li>
<li>
<p>Select the <code>Ansible Automation Platform</code> operator and click <code><strong>Install</strong></code></p>
<div class="imageblock">
<div class="content">
<img src="_images/walkthrough_operator_install.png" alt="Operator Install">
</div>
</div>
</li>
<li>
<p>Using the default options, with <code>Installed namespace: <strong>aap</strong></code>, click <code><strong>Install</strong></code> again</p>
</li>
<li>
<p>Wait for the operator to be installed and ready</p>
</li>
<li>
<p>Click on the installed operator, then find the <code>Ansible Application Platform</code> resource and click <code><strong>Create instance</strong></code></p>
<div class="imageblock">
<div class="content">
<img src="_images/walkthrough_aap_create.png" alt="Operator Install">
</div>
</div>
</li>
<li>
<p>Enter the following Name, Service Type and Ingress type, then click <code><strong>Create</strong></code>:</p>
<div class="imageblock">
<div class="content">
<img src="_images/walkthrough_aap_create_form.png" alt="Operator Install">
</div>
</div>
</li>
<li>
<p>Wait for the <code>Ansible Automation Platform</code> (AAP) creation to complete (around 10 minutes)</p>
</li>
<li>
<p>Once the pods are all running on the <code><strong>aap</strong></code> namespace, locate secret <code><strong>my-aap-admin-password</strong></code></p>
</li>
<li>
<p>Copy the <code><strong>password</strong></code> value, which will be used next to log into the AAP console</p>
</li>
<li>
<p>Under "Networking → Routes", open the URL for route <code><strong>my-aap</strong></code></p>
</li>
<li>
<p>Login as admin using the password you copied earlier</p>
</li>
<li>
<p>You will be prompted to <strong>enter your subscription information</strong></p>
</li>
<li>
<p>Once you supply your subscription details, you should be logged into the AAP console</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_your_ansible_automation_platform_instance"><a class="anchor" href="#_configuring_your_ansible_automation_platform_instance"></a><a class="link" href="#_configuring_your_ansible_automation_platform_instance">2.3. Configuring your Ansible Automation Platform instance</a></h3>
<div class="paragraph">
<p>In order to validate this solution pattern, we will need to configure the Ansible Automation Platform (AAP) instance first.</p>
</div>
<div class="paragraph">
<p>Since the goal is to demonstrate how Red Hat Service Interconnect (RHSI) helps you connect your AAP automation with managed hosts that are not reachable,
the AAP configuration used in this solution pattern is minimal.</p>
</div>
<div class="paragraph">
<p>Here is what we will configure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A project to run against all hosts</p>
</li>
<li>
<p>Two inventories (one for each third-party network)</p>
</li>
<li>
<p>Define the credentials</p>
</li>
<li>
<p>Two job templates (one for each third-party network)</p>
</li>
<li>
<p>A workflow job template (to run all third-party related job templates)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_create_a_project"><a class="anchor" href="#_create_a_project"></a><a class="link" href="#_create_a_project">2.3.1. Create a project</a></h4>
<div class="paragraph">
<p>The Ansible project that will be used in this solution pattern is a simple fork from the ansible-tower-samples repository
which includes an extra task that simply creates a directory under <code><strong>/tmp</strong></code> named <code><strong>created-by-aap</strong></code>.
This helps validate that AAP has actually connected and performed this respective task against the target host.</p>
</div>
<div class="paragraph">
<p>In the AAP console, perform the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to <code><strong>Projects</strong></code> on the left menu (under <em>Automation Execution</em>)</p>
</li>
<li>
<p>Click <code><strong>Create project</strong></code></p>
</li>
<li>
<p>Enter the following data:</p>
<div class="ulist">
<ul>
<li>
<p>Name: <strong>third-party-networks</strong></p>
</li>
<li>
<p>Organization: <strong>Default</strong></p>
</li>
<li>
<p>Execution environment: <strong>Default execution environment</strong></p>
</li>
<li>
<p>Source control type: <strong>Git</strong></p>
</li>
<li>
<p>Source control URL: <a href="https://github.com/fgiorgetti/ansible-tower-samples.git"><strong>https://github.com/fgiorgetti/ansible-tower-samples.git</strong></a></p>
</li>
<li>
<p>Source control branch/tag/commit: <strong>master</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Click: <strong>Create project</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_inventories"><a class="anchor" href="#_create_the_inventories"></a><a class="link" href="#_create_the_inventories">2.3.2. Create the inventories</a></h4>
<div class="paragraph">
<p>Now that the project has been created, we will create two inventories. One for each third-party network.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to Infrastructure → Inventories on the left menu (under <em>Automation Execution</em>)</p>
</li>
<li>
<p>Click: <code><strong>Create inventory → Create inventory</strong></code></p>
</li>
<li>
<p>Enter the following data:</p>
<div class="ulist">
<ul>
<li>
<p>Name: <strong>third-party-network-a</strong></p>
</li>
<li>
<p>Organization: <strong>Default</strong></p>
</li>
<li>
<p>Click: <strong>Create inventory</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Repeat the same steps to create the inventory named: <strong>third-party-network-b</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Next we need to add the target hosts for each inventory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the <code><strong>third-party-network-a</strong></code> inventory and click the <code><strong>Hosts</strong></code> tab</p>
</li>
<li>
<p>Click the <code><strong>Create host</strong></code> button</p>
</li>
<li>
<p>Enter the following data:</p>
<div class="ulist">
<ul>
<li>
<p>Name: <strong>server-a1</strong></p>
</li>
<li>
<p>Set variables to (using YAML format):</p>
<div class="paragraph">
<p><strong>ansible_host: server-a1.net-a</strong></p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Repeat the previous steps to create: <strong>server-a2</strong> and <strong>server-a3</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then we need to add the hosts for the second third-party network.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the <strong>third-party-network-b</strong> inventory and click the <strong>Hosts</strong> tab</p>
</li>
<li>
<p>Click the <strong>Create host</strong> button</p>
</li>
<li>
<p>Enter the following data:</p>
<div class="ulist">
<ul>
<li>
<p>Name: <strong>server-b1</strong></p>
</li>
<li>
<p>Set variables to (using YAML format):</p>
<div class="paragraph">
<p><strong>ansible_host: server-b1.net-b</strong></p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Repeat the previous steps to create: <strong>server-b2</strong> and <strong>server-b3</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As you may have noticed, our inventories rely that the servers will be reachable through the following hostnames:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>server-a1.net-a</p>
</li>
<li>
<p>server-a2.net-a</p>
</li>
<li>
<p>server-a3.net-a</p>
</li>
<li>
<p>server-b1.net-b</p>
</li>
<li>
<p>server-b2.net-b</p>
</li>
<li>
<p>server-b3.net-b</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this point, these hosts cannot be resolved by AAP, but once we finish the setup of our solution, AAP should be
able to resolve and connect with these hosts.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_credentials"><a class="anchor" href="#_create_the_credentials"></a><a class="link" href="#_create_the_credentials">2.3.3. Create the credentials</a></h4>
<div class="paragraph">
<p>The inventories that will be used by Ansible have been defined, but we did not specify the credentials that Ansible
will use to connect with those servers through SSH.<br>
To keep it simple we will create two <code><strong>Machine</strong></code> (type) credentials. One for each third-party network.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to <code><strong>Infrastructure → Credentials</strong></code> (under Automation Execution)</p>
</li>
<li>
<p>Click <code><strong>Create credential</strong></code></p>
</li>
<li>
<p>Enter the following data:</p>
<div class="ulist">
<ul>
<li>
<p>Name: <strong>third-party-network-a</strong></p>
</li>
<li>
<p>Organization: <strong>Default</strong></p>
</li>
<li>
<p>Credential type: <strong>Machine</strong></p>
</li>
<li>
<p>Username: <strong>cloud-user</strong></p>
</li>
<li>
<p>Password: <strong>cloud-password-a</strong></p>
</li>
<li>
<p>Click the <code><strong>Create credential</strong></code> button</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Repeat the same steps to create a credential named <strong>third-party-network-b</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure you are using the correct credentials for your servers.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_job_templates"><a class="anchor" href="#_create_the_job_templates"></a><a class="link" href="#_create_the_job_templates">2.3.4. Create the job templates</a></h4>
<div class="paragraph">
<p>We need to create two job templates.</p>
</div>
<div class="paragraph">
<p>They will basically tie the Ansible project to be executed with the inventory that defines the target hosts and
associate the credential to be used for each third-party network.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to <code><strong>Templates</strong></code> (under Automation Execution) on the left menu</p>
</li>
<li>
<p>Click the <code><strong>Create template</strong></code> button, then click <code><strong>Create job template</strong></code></p>
</li>
<li>
<p>Enter the following data:</p>
<div class="ulist">
<ul>
<li>
<p>Name: <strong>third-party-network-a</strong></p>
</li>
<li>
<p>Inventory: <strong>third-party-network-a</strong></p>
</li>
<li>
<p>Project: <strong>third-party-networks</strong></p>
</li>
<li>
<p>Playbook (should be automatically set): <strong>hello_world.yml</strong></p>
</li>
<li>
<p>Credentials: <strong>third-party-network-a</strong></p>
</li>
<li>
<p>Click the <code><strong>Create job template</strong></code> button</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Repeat the steps above for <strong>third-party-network-b</strong>.</p>
</div>
<div class="paragraph">
<p>After both <em>Job Templates</em> have been created, we need to create a <code><strong>Workflow job template</strong></code>.<br>
It will be used to trigger both job templates at once.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to <code><strong>Templates</strong></code> (under Automation Execution) on the left menu</p>
</li>
<li>
<p>Click the <code><strong>Create template</strong></code> button, then click <code><strong>Create workflow job template</strong></code></p>
</li>
<li>
<p>Enter the following data:</p>
<div class="ulist">
<ul>
<li>
<p>Name: third-party-networks</p>
</li>
<li>
<p>Organization: Default</p>
</li>
<li>
<p>Click the <code><strong>Create workflow job template</strong></code> button</p>
</li>
<li>
<p>Click the <code><strong>Add step</strong></code> button</p>
</li>
<li>
<p>Node type: Job Template</p>
</li>
<li>
<p>Job Template: third-party-network-a</p>
</li>
<li>
<p>Click the <code><strong>Next</strong></code> button</p>
</li>
<li>
<p>Click the <code><strong>Finish</strong></code> button</p>
</li>
<li>
<p>Click the  <code><strong>Add step</strong></code> button</p>
</li>
<li>
<p>Node type: Job Template</p>
</li>
<li>
<p>Job Template: third-party-network-b</p>
</li>
<li>
<p>Click the <code><strong>Next</strong></code> button</p>
</li>
<li>
<p>Click the <code><strong>Finish</strong></code> button</p>
</li>
<li>
<p>Click the <code><strong>Save</strong></code> button</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You should end up with something like shown in the workflow below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/walkthrough_aap_workflow_created.png" alt="Workflow job template">
</div>
</div>
<div class="paragraph">
<p>At this point, all the AAP configuration needed is done.</p>
</div>
<div class="paragraph">
<p>Now we need to install and configure <strong>Red Hat Service Interconnect</strong> to link the third-party networks with the Red Hat OpenShift cluster.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_red_hat_service_interconnect_on_red_hat_openshift"><a class="anchor" href="#_installing_red_hat_service_interconnect_on_red_hat_openshift"></a><a class="link" href="#_installing_red_hat_service_interconnect_on_red_hat_openshift">2.4. Installing Red Hat Service Interconnect on Red Hat OpenShift</a></h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>THE FOLLOWING INSTRUCTIONS USE THE UPSTREAM VERSION OF RHSI (SKUPPER V2)<br>
ONCE RHSI V2 IS RELEASED, THIS WHOLE SECTION MUST BE UPDATED TO USE RHSI V2 INSTEAD.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We need to install <strong>Red Hat Service Interconnect</strong> in two separate namespaces.<br>
The reason for this is to ensure that each third-party network is connected to an isolated <em>Virtual Application Network</em> (VAN).</p>
</div>
<div class="paragraph">
<p>Along with that we will also create <em>Network Policies</em> to ensure that each namespace is only accessible to AAP,
so that the third-party servers exposed into the Red Hat OpenShift cluster can only be reached internally by AAP.</p>
</div>
<div class="sect3">
<h4 id="_installing_the_red_hat_service_interconnect_controller"><a class="anchor" href="#_installing_the_red_hat_service_interconnect_controller"></a><a class="link" href="#_installing_the_red_hat_service_interconnect_controller">2.4.1. Installing the <strong>Red Hat Service Interconnect</strong> controller</a></h4>
<div class="paragraph">
<p>The RHSI controller is deployed to its own namespace and it has the ability to watch for RHSI resources across all namespaces
in the Red Hat OpenShift cluster.<br>
Let&#8217;s install the RHSI controller:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open a terminal</p>
</li>
<li>
<p>Set the <strong>KUBECONFIG</strong> environment variable</p>
<div class="ulist">
<ul>
<li>
<p>You must be logged in as a cluster administrator</p>
</li>
</ul>
</div>
</li>
<li>
<p>Create the <code><strong>skupper</strong></code> namespace, using:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">kubectl create namespace skupper</code></pre>
</div>
</div>
</li>
<li>
<p>The RHSI V2 controller can be installed using:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">kubectl -n skupper apply -f https://skupper.io/v2/install.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Now wait for the <strong>skupper-controller</strong> pod to be running on the <strong>skupper</strong> namespace:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">kubectl -n skupper wait --for=condition=Ready pod -l application=skupper-controller</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_create_namespaces_for_each_third_party_network"><a class="anchor" href="#_create_namespaces_for_each_third_party_network"></a><a class="link" href="#_create_namespaces_for_each_third_party_network">2.4.2. Create namespaces for each third-party network</a></h4>
<div class="paragraph">
<p>Once the RHSI controller is running, we need to apply the RHSI Custom Resources (CRs) for the RHSI controller to create the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sites</p>
</li>
<li>
<p>Listeners</p>
</li>
<li>
<p>AccessTokens</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first thing we need to do is create the namespaces for third-party networks A and B.<br>
The namespaces will be named: <code><strong>net-a</strong></code> and <code><strong>net-b</strong></code> respectively.</p>
</div>
<div class="paragraph">
<p>These namespaces have already been used to compose the expected fully qualified hostnames
used in the AAP inventories, example given: <code><strong>server-a1.net-a</strong></code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the custom resources we need to define these two RHSI sites.<br>
The resources can be found at <code><strong>./cloud/net-a</strong></code> and <code><strong>./cloud/net-b</strong></code> folders.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><strong>Site</strong></code></p>
<div class="ulist">
<ul>
<li>
<p>A Site represents a separate RHSI instance</p>
</li>
<li>
<p>You can only have a single RHSI site per namespace</p>
</li>
<li>
<p>It is the main resource to be created</p>
</li>
</ul>
</div>
</li>
<li>
<p><code><strong>AccessGrant</strong></code></p>
<div class="ulist">
<ul>
<li>
<p>Grants the permission for other sites to redeem AccessTokens to this site</p>
</li>
<li>
<p>AccessTokens can be generated once the AccessGrant is ready</p>
</li>
</ul>
</div>
</li>
<li>
<p><code><strong>Listener</strong></code></p>
<div class="ulist">
<ul>
<li>
<p>Represents an ingress to target workloads exposed in your Virtual Application Network (VAN)</p>
</li>
<li>
<p>On OpenShift / Kubernetes they are realized as a Service</p>
</li>
<li>
<p>Listeners must have a corresponding Connector available in some other Site linked to the VAN</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both sites set the <strong><em>linkAccess</em></strong> value to <strong><em>default</em></strong>. This will ensure that the default ingress method for the target
cluster will be used.<br>
On Red Hat OpenShift clusters, a <strong>Route</strong> should be created, otherwise a <strong>LoadBalancer</strong> service will be created.
This ingress method is used to accept incoming links coming from other Sites.</p>
</div>
<div class="paragraph">
<p>The <code><strong>AccessGrant</strong></code> allows a single <code><strong>AccessToken</strong></code> to be redeemed and it must be redeemed within 30 minutes
from <code><strong>AccessGrant</strong></code> creation, otherwise it won&#8217;t be valid.</p>
</div>
<div class="paragraph">
<p>Each site has a <code><strong>Listener</strong></code> for each target server expected by AAP.
The <code><strong>spec.host</strong></code> field determines the Service name that will be created on the respective namespace,
therefore the fully qualified service name will be composed by the spec.host field plus the namespace
name, matching the hostnames added to the inventories in AAP.</p>
</div>
<div class="paragraph">
<p>The <code><strong>spec.routingKey</strong></code> is used to determine the matching Connector.
So the RHSI sites created inside the third-party networks, must define the respective <code><strong>spec.routingKey</strong></code>.</p>
</div>
<div class="paragraph">
<p>Along with the RHSI resources, there are two <em>Network policies</em> defined to add an extra security layer (one for each namespace),
preventing undesired internal access to your third-party network namespaces.
These <code><strong>NetworkPolicies</strong></code> allow ingress to the <code><strong>skupper-router</strong></code> pod only coming from pods running on the <code><strong>aap</strong></code> or the
self namespace (<code><strong>net-a</strong></code> or <code><strong>net-b</strong></code>).</p>
</div>
<div class="paragraph">
<p>To create the namespaces, the RHSI sites and the network policies, run:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">kubectl apply -f ./cloud/net-a/
kubectl apply -f ./cloud/net-b/</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can verify that your sites have been created running:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">kubectl -n net-a get pod,site
kubectl -n net-b get pod,site</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you should see an output similar to this one:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre>NAME                                  READY   STATUS    RESTARTS   AGE
pod/skupper-router-78b5b8ddb5-h76sm   2/2     Running   0          53m

NAME                    STATUS   SITES IN NETWORK
site.skupper.io/net-a   OK


NAME                                  READY   STATUS    RESTARTS   AGE
pod/skupper-router-5f54dd4f88-24rzh   2/2     Running   0          54m

NAME                    STATUS   SITES IN NETWORK
site.skupper.io/net-b   OK</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_preparing_site_bundles_for_third_party_networks"><a class="anchor" href="#_preparing_site_bundles_for_third_party_networks"></a><a class="link" href="#_preparing_site_bundles_for_third_party_networks">2.4.3. Preparing site bundles for third-party networks</a></h4>
<div class="paragraph">
<p>A site bundle is a compressed file that contains a whole RHSI site definition to run outside of Kubernetes or OpenShift.<br>
They can be installed to run as a container, using Podman or Docker and also as an regular process on a Red Hat Enterprise Linux server,
which will require a local installation of the <code><strong>skupper-router</strong></code> <em>RPM</em> package.</p>
</div>
<div class="paragraph">
<p>The site bundle is an easy approach to install a prepared site definition on a remote location, but you could also create
a non-Kubernetes site using the Skupper V2 CLI or a bootstrap container.</p>
</div>
<div class="paragraph">
<p>Here are the Custom Resources (CRs) needed to define the site bundles.
* <code><strong>Site</strong></code>
* <code><strong>Connector</strong></code>
* <code><strong>AccessToken</strong></code> (will be generated from <code><strong>AccessGrants</strong></code> created earlier)</p>
</div>
<div class="paragraph">
<p>In order to prepare a site bundle to be installed at the Third Party Networks, we will use the CRs located under
<code><strong>./internal/net-a</strong></code> and <code><strong>./internal/net-b</strong></code>.</p>
</div>
<div class="paragraph">
<p>Along with these CRs, we also need to generate <code><strong>AccessTokens</strong></code>, so that the bundles have the ability to establish
an RHSI link against the RHSI site running on the Red Hat OpenShift cluster on namespaces <code><strong>net-a</strong></code> and <code><strong>net-b</strong></code> respectively.</p>
</div>
<div class="paragraph">
<p>To generate the <code><strong>AccessTokens</strong></code> we will need to extract some information from the <code><strong>AccessGrant</strong></code> created on both
<code><strong>net-a</strong></code> and <code><strong>net-b</strong></code> namespaces.<br>
To do it, execute the <code><strong>./scripts/generate-access-token.sh</strong></code> script, using:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">./scripts/generate-access-token.sh net-a &gt; ./internal/net-a/20-token.yaml
./scripts/generate-access-token.sh net-b &gt; ./internal/net-b/20-token.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that all the CRs are in place, we must generate the site bundles, using:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">curl -s https://raw.githubusercontent.com/skupperproject/skupper/refs/heads/v2/cmd/bootstrap/bootstrap.sh | sh -s -- -p ./internal/net-a -b bundle
curl -s https://raw.githubusercontent.com/skupperproject/skupper/refs/heads/v2/cmd/bootstrap/bootstrap.sh | sh -s -- -p ./internal/net-b -b bundle</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bundles will be generated and their location can be found through a message that says:
"<em>Installation bundle available at</em>". Example given:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre>Installation bundle available at: /home/my-user/.local/share/skupper/bundles/skupper-install-net-a.sh</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_the_third_party_networks"><a class="anchor" href="#_connecting_the_third_party_networks"></a><a class="link" href="#_connecting_the_third_party_networks">2.5. Connecting the Third-party Networks</a></h3>
<div class="paragraph">
<p>The last piece is to install the generated site-bundles on the respective servers for each target third-party network.</p>
</div>
<div class="paragraph">
<p>To install, you should just send the site bundle file: <code><strong>skupper-install-net-a.sh</strong></code> or <code><strong>skupper-install-net-b.sh</strong></code> to
the target server where the RHSI site will be installed, then execute it, for example:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">scp skupper-install-net-a.sh my-user@my-server-third-party-net-a:
./skupper-install-net-a.sh -n net-a</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">scp skupper-install-net-b.sh my-user@my-server-third-party-net-b:
./skupper-install-net-b.sh -n net-b</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The commands above have been executed against an internal hostname that
represents the server where the RHSI site bundle will be installed and these
servers can reach the target hosts that will be managed by AAP.<br>
Update the commands to use your own hostnames or IP addresses.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want your <strong>Third Party Network A</strong> site to run using a regular process and not a container, you must first
install the <code><strong>skupper-router</strong></code> <em>RPM</em> package and then you should run the bundle installation script as:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">scp skupper-install-net-a.sh my-user@my-server-third-party-net-a:
./skupper-install-net-a.sh -n net-a -p systemd</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once both bundles have been installed, the three servers behind each third party network should be exposed and accessible
by AAP inside the Red Hat OpenShift cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_validating_the_scenario"><a class="anchor" href="#_validating_the_scenario"></a><a class="link" href="#_validating_the_scenario">2.6. Validating the scenario</a></h3>
<div class="paragraph">
<p>Now the whole scenario has been deployed and the <strong><em>Workflow job template</em></strong> that was created on AAP should be able to run and
reach all servers.</p>
</div>
<div class="paragraph">
<p>Back to the AAP console, go to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><strong>Templates</strong></code> (under Automation Execution)</p>
</li>
<li>
<p>Click the <code><strong>third-party-networks</strong></code> workflow job template</p>
</li>
<li>
<p>Click the <code><strong>Launch template</strong></code> button</p>
</li>
<li>
<p>Watch the workflow</p>
</li>
<li>
<p>You should see a successful result</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/walkthrough_aap_workflow_success.png" alt="Workflow job template successful">
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="02-architecture.html" class="query-params-link">2. Architecture</a></span>
  <span class="next"><a href="developer-resources.html" class="query-params-link">4. Developer Resources</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <img
          src="../_/img/app-services-logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns"  href="https://redhat.com" ></a>
</footer><script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
